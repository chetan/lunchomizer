
<html>
<head>
    <title>the lunch-o-mizer! a random lunch suggestion, every day, at lunchtime</title>

    <%= csrf_meta_tag %>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>

    <%= stylesheet_link_tag "960", "reset", "text", :media => "screen, projection" %>
    <%= stylesheet_link_tag "lunch" %>

    <script src="http://code.google.com/apis/gears/gears_init.js" type="text/javascript"></script>

    <%= javascript_include_tag "application", "geo" %>
    <%#= javascript_include_tag "geo_position_js_simulator" %>

    <%# sensor=false because for these maps, we don't want to use the user's location sine we are
        providing all the input data needed to render correctly. %>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

    <%=raw @close_map.header_html if @close_map %>
    <%=raw @near_map.header_html if @near_map %>
    <%=raw @far_map.header_html if @far_map %>

    <%# add click handlers for toggling the maps %>
    <script type="text/javascript" charset="utf-8">

        $(window).load(function() {

            $(".toggle_close").click(function() {
                $("#close_info").toggle();
                <%= @close_map.recenter_html() %>
            });

            $(".toggle_near").click(function() {
                $("#near_info").toggle();
                <%= @near_map.recenter_html() %>
            });

            $(".toggle_far").click(function() {
                $("#far_info").toggle();
                <%= @far_map.recenter_html() %>
            });

        });
    </script>

    <% if @trygeo then %>
    <script type="text/javascript">

        // use for testing with a pre-set lat/lng
        // if (geo_position_js_simulator) {
        //     locations=new Array();
        //     locations.push({ coords:{latitude: 40.757912,longitude: -73.9697795},duration:5000 });
        //     geo_position_js_simulator.init(locations);
        // }

        if (geo_position_js.init()) {
            geo_position_js.getCurrentPosition(success_callback,error_callback,{enableHighAccuracy:true,options:5000});
        }

        function success_callback(p) {
            window.location = (window.location + "?lat=" + p.coords.latitude +'&lng=' + p.coords.longitude);
        }

        function error_callback(p) {
        }
    </script>
    <% end %>

</head>
<body>

<div class="container_12">

<div class="grid_2">&nbsp;</div>

<div class="grid_10">

    <h1>the lunch-o-mizer!</h1>

    <%= form_tag do %>
        <label for="address">Location:</label> <input id="address" type="text" name="address" value="<%= @address %>"> <input type="submit" value="Change">
    <% end %>

    <br/>


    <%# show closest option %>
    <h2>close:
    <% if @close then %>
        <span class="toggle_close">
        <%= @close.name %> (<%= get_address(@close) %>)
        <%= image_tag("map_20x20.png", :size => "20x20", :alt => "View map") %>
        </span>
        </h2>
        <div id="close_info">
            <%= render :partial => "info", :locals => { :info => @close } %>
            <div id="close_map" style="width:600px;height:400px"></div>
        </div>
    <% else %>
        n/a
        </h2>
    <% end %>


    <%# show somewhat nearby option %>
    <h2>near:
    <% if @near then %>
        <span class="toggle_near">
        <%= @near.name %> (<%= get_address(@near) %>)
        <%= image_tag("map_20x20.png", :size => "20x20", :alt => "View map") %>
        </span>
        </h2>
        <div id="near_info">
            <%= render :partial => "info", :locals => { :info => @near } %>
            <div id="near_map" style="width:600px;height:400px"></div>
        </div>
    <% else %>
        n/a
        </h2>
    <% end %>


    <%# this option is a bit of a hike %>
    <h2>far:
    <% if @far then %>
        <span class="toggle_far">
        <%= @far.name %> (<%= get_address(@far) %>)
        <%= image_tag("map_20x20.png", :size => "20x20", :alt => "View map") %>
        </span>
        </h2>
        <div id="far_info">
            <%= render :partial => "info", :locals => { :info => @far } %>
            <div id="far_map" style="width:600px;height:400px"></div>
        </div>
    <% else %>
        n/a
        </h2>
    <% end %>

</div>

</body>
</html>
