
<html>
<head>
    <title>the lunch-o-mizer! a random lunch suggestion, every day, at lunchtime</title>

    <%= csrf_meta_tag %>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>

    <%= stylesheet_link_tag "960", "reset", "text", :media => "screen, projection" %>
    <%= stylesheet_link_tag "lunch" %>

    <script src="http://code.google.com/apis/gears/gears_init.js" type="text/javascript"></script>

    <%= javascript_include_tag "application", "geo" %>
    <%#= javascript_include_tag "geo_position_js_simulator" %>

    <%# sensor=false because for these maps, we don't want to use the user's location sine we are
        providing all the input data needed to render correctly. %>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

    <%= @close_map.header_html if @close_map %>
    <%= @near_map.header_html if @near_map %>
    <%= @far_map.header_html if @far_map %>

    <% if @trygeo %>
    <script type="text/javascript">

        // use for testing with a pre-set lat/lng
        // if (geo_position_js_simulator) {
        //     locations=new Array();
        //     locations.push({ coords:{latitude: 40.757912,longitude: -73.9697795},duration:5000 });
        //     geo_position_js_simulator.init(locations);
        // }

        if (geo_position_js.init()) {
            geo_position_js.getCurrentPosition(success_callback,error_callback,{enableHighAccuracy:true,options:5000});
        }

        function success_callback(p) {
            window.location = (window.location + "?lat=" + p.coords.latitude +'&lng=' + p.coords.longitude);
        }

        function error_callback(p) {
        }
    </script>
    <% end %>

</head>
<body>

<div class="container_12">

<div class="grid_2">&nbsp;</div>

<div class="grid_10">

    <h1>the lunch-o-mizer!</h1>

    <%= form_tag do %>
        <label for="address">Location:</label> <input id="address" type="text" name="address" value="<%= @address %>"> <input type="submit" value="Change">
    <% end %>

    <h2>close:
    <% if @close then %>
        <%= @close.name %> (<%= get_address(@close) %>) <a class="toggle" href="#" onclick="$('#close_map').toggle(); <%= @close_map.recenter_html() %> "><%= image_tag("map_20x20.png", :size => "20x20", :alt => "View map") %></a></h2>
        <div id="close_map" style="width:600px;height:400px"></div>
    <% else %>
        n/a</h2>
    <% end %>

    <h2>near:
    <% if @near then %>
        <%= @near.name %> (<%= get_address(@near) %>) <a class="toggle" href="#" onclick="$('#near_map').toggle(); <%= @near_map.recenter_html() %>"><%= image_tag("map_20x20.png", :size => "20x20", :alt => "View map") %></a></h2>
        <div id="near_map" style="width:600px;height:400px"></div>
    <% else %>
        n/a</h2>
    <% end %>

    <h2>far:
    <% if @far then %>
        <%= @far.name %> (<%= get_address(@far) %>) <a class="toggle" href="#" onclick="$('#far_map').toggle(); <%= @far_map.recenter_html() %>"><%= image_tag("map_20x20.png", :size => "20x20", :alt => "View map") %></a></h2>
        <div id="far_map" style="width:600px;height:400px"></div>
    <% else %>
        n/a</h2>
    <% end %>

</div>

</body>
</html>
